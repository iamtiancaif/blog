---
layout: post
title:  "basic about nio selector"
categories: computer
tags:  computer java nio question
author: "占小狼"
source: "https://www.jianshu.com/p/0d497fe5484a"
---

* content
{:toc}



> 简书 [占小狼](https://www.jianshu.com/users/90ab66c248e6/latest_articles) 转载请注明原创出处，谢谢！

### 前言

Java NIO 由以下几个核心部分组成：  
1、Buffer  
2、Channel  
3、Selector

Buffer和Channel在[深入浅出NIO之Channel、Buffer](https://www.jianshu.com/p/052035037297)一文中已经介绍过，本文主要讲解NIO的Selector实现原理。

之前进行socket编程时，accept方法会一直阻塞，直到有客户端请求的到来，并返回socket进行相应的处理。整个过程是流水线的，处理完一个请求，才能去获取并处理后面的请求，当然也可以把获取socket和处理socket的过程分开，一个线程负责accept，一个线程池负责处理请求。

但NIO提供了更好的解决方案，采用选择器（Selector）返回已经准备好的socket，并按顺序处理，基于通道（Channel）和缓冲区（Buffer）来进行数据的传输。

### Selector

这里出来一个新概念，selector，具体是一个什么样的东西？

想想一个场景：在一个养鸡场，有这么一个人，每天的工作就是不停检查几个特殊的鸡笼，如果有鸡进来，有鸡出去，有鸡生蛋，有鸡生病等等，就把相应的情况记录下来，如果鸡场的负责人想知道情况，只需要询问那个人即可。

在这里，这个人就相当Selector，每个鸡笼相当于一个SocketChannel，每个线程通过一个Selector可以管理多个SocketChannel。

![](data:image;base64,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bNmy4x57MstnAgDOPgR6AEXnTCzFOFfJTl4kEnne550a6NPptD7wgQ/osccem/NYl8sll8ulVCqlRCIx6/vpdNp8cSJJXq/3uD87/04AAABTEegBnHVWrFgx7fadd945banK4ykvLzc//8IXvjAtzF955ZV6y1veolWrVqmqqsp8YXLrrbfOuYSmw+FQKBRSd3e3JCkcDh/3Z0+t3wcAII9AD+Css3Llymm3M5mMWlpaTukcmUzGXNJSyi5Z+ZnPfGbOY2eW+EzV2NhoBvrDhw8f92fmV8oBAGAqVrkBcNZpbm6etlnV1JVmZrr33nt1ySWXmB/5UL1//35NTk6ax73qVa+a8/79/f3asWPHvOffsGGD+fnTTz+t3t7eOY+bmJjQQw89VOiHDgBQhAj0ABbU1FKWsbGx06pfP1PKy8v113/91+bt+++/X1u2bJl13P79+/XFL35RqVRKqVRKra2tWr16taTZE3IHBwdn3X90dFQf+tCHzE2j5nL11Veb9f6ZTEY33HCDxsbGph0Tj8f18Y9//LjnAQCcvSi5AbCgptarp1Ipbd68WaFQSC6XS9/97ncL1q53vvOd+vWvf63+/n5lMhm9733v0xVXXKGNGzcqFovpiSee0J49e8zg7vF49OEPf9i8/5o1a+T1es1R+ttuu0379+/XS17yEsXjce3Zs0c/+tGPTvgCpry8XFdffbW+/vWvS5K2b9+uq6++WpdddpnWrFmj7u5ubdmyhXIbAMC8CPQAFtSLX/xirV692gyk4+Pj2r9//7wbOS0Wn8+nW265RTfccINZw/7II4/okUcemfPYT33qU1q/fr35NZfLpQ9/+MP61Kc+JUmKRqO6++67Z01+XbFihTZv3qyvfvWr87bl7//+7zU6Oqp77rlHUnYlnR/96Eezjrvkkkv0pz/9qaCPGwCg+FByA2BB2e123XXXXXrd616nhoaGM7Ik5Zly7rnn6u6779Zb3vKWOV9g2O12bd68WT/72c90xRVXzPr+61//et14441zrptfXl6u1772tfrud7+rVatWHbcdTqdT119/vT71qU/NuRa93+/Xxz/+cX3wgx8s9EMGAChCNsMwjEI3AgAKLZPJqLOzUwcOHFAymdSqVau0YsWKE64NL2Vr3A8cOKDOzk55vV6dc845s3aTPRXhcFh79+5VJBJRS0uLVqxYUVQv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Nm1apze+8TKVlBx/9ZLDR/r1yG+3am/bEe3b1ymPx6WWlia1rGvUZZedr8bGmtNu59atbfrjn3arbe8RtXf0qGZZuVrWN6llXZOuvPIiBQL+E57j8JF+Pfr7Z9W2r1P79nUqPplQqL5ajY01euMbLlNr66ppxz/55C5t254ts+ntDZtfP3CgW1/7r/vM29dd+8o5H6P29h797vfPav/+Lu3f3ylJWru2UWvXLteVV1yklSvr5mzn0aMj+slPf2/efttbXy6Xy6VvfvMBPfHkTqVTaa1fv0I33fQOeTzu035sn78ZO8fmS8zMybGMoQFYGDbDCssoALCw3KofGpc0KBnRQjdoXj/72R9025d+pFgsPu8xJSU+ffIT/59e/vJNc37/wQf/qM99/rvznsPv9+imG/8/XXXVxbO+d++9f9BnP/c/5u0//fFOOZ2OacekUml95faf6nvf+9W8bWxsrNEXb3231qxZPu8xD/ziCd188/eP+7u+6EUbdcvN75Tf75Ukffnf7znuzz32GNyq2poK87ZhGPrBD3+j22//qRKJuUer3W6X3vueN+uv/upK2WYU5e/Zc1jXXPtp8/a3v/VRffGLP9Su3YemHfe7R/5DZWUlJ2zforL5JVVLKpXkEqEewEKgZwGwwPIb7RR3LfFvfrtVn/3c9CBut9tVW1MxbdR3YiKmG/7tG7PCpCTd/tV79fEbvzHtHIGAf9poeTQa1/Uf+S997Wv3nfojmc7oXe++bVaorqwsm9bGzs4B/e07Pqc//GH7nOf54m1366abvjWtnT6fR263a9pxTzyxUx+74evKZE5v3OdDH/6avvSlH00L8z6fRz6fx7ydSCT1xdvu1oc+/LUTnu/WOcJ80TKmXv+UmgFYGJTcLEHRaFThcFiRSESJREKpFPWbKJxAwKv6er8CAaOoa4nv/emj5rrvtTUV+sxn/kGtrSvl8biVyRja8th2/du/fUPR6KTi8YS++92HdfPn/8m8f1vbEX3nO780b196aauu//DVZnlNf/+Q7rjjPj3wiyckSd/81i/0l3958XFH0We6555H9Mwz+8zb11z9Cv39329WIOCXYRjaveewbr31B9qxo12Tkwl9/ubv6YUvbJXbfayr37GjXT/84W/M283N9frUJ/9OLS1NSiaTevrpNv3svi363e+ekSRt2bJd9//vY3rD6y/T6173El144TpJ0le/eq/a23skSRdcsFbXXvtK85wV5aXm57/85R/Nc0nSeeet1kc+co3WrmmQJO3f36XPff572rmzXZL0u989o4ce+pNe9apL5n0cdufCfEN9tTZd1KJkMqUjR/pltxfhGJUtIymuSCSunp5ORSKThW4RIJvNJpvNJp/Pp8rKSpWWlsrj8cjpJBZaFf9zS1A4HNbjjz+uffv2KRwOKxaLFbpJOIutW9es173uRQqUVquYR+j37D1sfv6iF5+rTZvWmbftdpteevkF+oe/36yv3P5TSdKf/7xHmUxGdrtdhmHoli/8wBzJbm6u15due8+0IF1bW6lPfvL/anRsQlu2bJdhGPr6Nx7QLTe/86TaNzwc0Z133W/efsPrL9P73/8287bNZlPrhpX6yn++T29/+03qHxjWwMCwfv7zLXrrW19uHvelL//I/Ly6Oqj//vZHzXp3j8etF7/4XF16aav+7u9v0XPPHZQk/fa3W/WG11+m1c31Wt1cL0n63vceNs9TU1Oul730glltjkSi+tKX7zFvn3fean3tjg/K6z32bkJLS5Pu/K9/1bvffZu2537el758j17ykvNUWjr/XIU3velyfehf/2baY1yUciP0vb2DeuCBJ9XWdrDQLQJks9nkcDi0fPlyXXzxxVq7dq1qamoI9BbG/9wSFIlEtG/fPm3dulVDQ0OKRou3ZhlLn82WUWRso6SK0z7XQlq1ss4MlL/5zdP6ixeco6uuulh2+7F67uuue5Wuu+5Vs+7b0dGr7dsPmLevueYV8wbN6659pbZsyZbC/Pa3W9XfP6Ta2soTtu83v3lakcixv+X/+39fM+dxgYBfb3zj5fqvO38uSfr+D35tBvojR/rNkC5J184zedVut+tvr3uV/ud/HpIkJRIppVLpWfX8J/LYY89paGjMvP3Of3r9tDCf5/W69a53vVHvfNcXJUnh8Kgef2KHXvmKv5jzvOvXr9BHrr9GDkcRjsjPkl2TfmxsTPv27dfWrc8WukGA7Ha77Ha7hoeHVV1drcrKSgWDQZWUFNkcFJw0Av0SlEgkFA6HNTQ0pHg8fvonBM4Cmze/2Az0kUhUH/3Ynbr1iz/Ui160UZf8xQZdemmrKioCc96341DvtNuDg6O67+db5jw2OaWO3DAMHTrUd1KBvqPj2M8oLfXpqaf36qmn98557OjYhPl5V9dRJRIpud1OHTnSP+24F126cd6f97KXXaiXvezC03pMp7Y5GCzVJZdsmPfYF7xgvSory8wXAPlynrm86U2XWyTMA8XJMAxlMhlNTk5qaGhIw8PDSiaThW4WTgOBfglKpVKKxWLmyHwgEFB9fb1KS0tP88zAqVu7tlmBQJkkh45tulN83vSmyzU+HtXtX71X6XS2NGhoaEwPPPCEHnjgCdntNrW2rtLmzS/S61/3Erlcx7rPqcFVku6442cn/XN7egZP6ripLxrGx2P69Ke/c1L3MwxDfX1hNTXV6vCMQB8KVS3oYzq1zSfzs5YvX2YG+o723nmPa15Vv6DtPrNskhwqKyvTunVrZRi8EEHhJBIJRSIR8yOfFyYnJ5VOM2nbygj0Z4H6+npt3rxZ69atO/2TAacoEPAqVO/P5hojqmJe6eO6616lV77yL3TvvX/QY4/vUFvbEXOibCZjaMeOdu3Y0a7vfOch3fHVD5gTXqeWwpyqninruR/P6fyM3t5soB8fPzafxm63L/ia7aMjx94pKCnxnvD4qceMjI7Pe5z/JM5VWPkXrjbJ5pDkVSi0XJs3v1YvfSmTYlE44XBY+/btU1tbm/bt23f6J0TRINCfBUpLS7Vu3TpdfPHFp38y4JQlJUUljUu2uGQU99u6tbWVete73qB3vesNGh6OaOvWNj319F797nfPKhwelZQdVf+nf7pVP/jBTSovL9WKpukbIt35X/+qwEmuh14ePLnjVjTVas+e7MTdhoZluvXWd5/071SfGx1fvnyZ+bVMJqNweFTLlpUv2GO5YmWttj7TJim7ys+JTN2sauWKuhMebwmGXbJ5FAiUqqWlUdm16IHC6OnpUSKR0ODgoDwez+mfEEWDQA9ggWVHKLO7ZY6f5rkWRiaTmbZGen7iZkVFQFdddbGuuupi/esH/0pfvO1u/eQnv5ck9Q8M68knd+rVr37hrB1OMxlDLesaz2gbV64MmZ/39YW1amXdrHXjT6SpsXba7UOH+uYN9Nu27dftX71XUnZFjP/49/8nv//UAsCqaW0e0sjIuMrL5y79GxkZV3f3sfKj5mYrldXMNGVjLFv++vcq+7cAAGcexXwAFphd2VFJd+5fh6YFniKwZ+8Rvfgl7zY/ZtaaS5LL5dQH3v+2abXzbfs6JWXD59RJmg8//Od5f9a99/5Bl7zwn8yPg8eZ/DnV2rXH1qtPpzP6zW+2znvsDf/2dfP8r3nth805AatWhaatMnPPjx+Z9xy/feQZPfvsfj377H4lk6lTDvOSdO65q83PU6m07rln/p93zz2PKJlMTblv8yn/vOKSrZ2X4cp+sEssgAVE7wJgEdiVDfIeZYN9cXU956xvmrbmeX65xpkOHOieFjrzZSHl5aX667++yvz6/f/7mLZseW7W/ffv79IXb7tbqVRaqVRara2rzHXdT+Tyyy9Q64aV5u2v3P7TWavWSNJ9923RQw/9yfwZm197qflio7TUp2uufoV57O9//6x+8eCTs86xa1eHfvKT35m3X/7yTbOOKS09tvttd9dRc67BVOee26yrrjpW6vetbz+oX/3qqVnHPfyrP+tb337QvP2KV7xAra2rTuW/sAjZlb3W3cq+GV5c1zyApYWSGwCLJB/ok8pOjC2eybF2u12vfc2l+lFuBPm++7aou/uoXnhJq8rLSzU+EdO+tk49MmXHU7vdrgsuWGvefuc/vV6//vXT6u8fUiZj6H3v/09dccUmbdzYrFgsriee2Kk9ew6Zm095PG59+EN/fQpttOmGG67TNdd+RplMRgMDw/qbqz+lV7/6Eq1ubtCRI/164smd6uwcMO+zYkXdtB1cJelv//bV+tl9WxQOjyqTMXTjjd/Ub3+zVeedt1out1Nte4/ooYf/ZI7qr1hRp7e8+aWz2rNiRa225Fbm3LX7kF79mg+pvLxU55+3Rh/96DXmcR/8wNv1xBM7FY1OKplM6WM33KUHfvGEzj9/jSRp+7YDeuLJneYLAr/fqw+8/+2FviTOALskr2TziqdaAAuNXgbAIsnVEttSkiaLbgXL97//bdq955B27GiXJD311F499dTeeY//4AffPq123ufz6Jab36kbbrhL3bmlKB955Bk98sgzs+7r83n0qU/+ndavX3FKbWxpadK//dt1uvXWHyoWiysWi+vee/8w57GhUJW+/OX3KBDwT/u63+/Rf/7He/WRj95phv9H/7BNj/5h26xz+P1e3fbFf55z86m3v+0K3XPP75RIZCc5Hz06oqNHR1RdHZx2XE1NhW6//f36+L99Xd09gzIMQ48/vkOPP75j1jkb6qv16c/8w4JO1F08+RewXjE6D2Ch0csAWCRTShCM4qujd7mcuuOrH9B7/uXN824gJUmbNq3TrV94t/7q7VfO+t655zbr7rs/qbe85WVzTli1223avPlF+tm9n9UVV2zS8/H6171EP/rRJ3XJJRum7WKb5/d79O53v1H3/vQzWtFUO+c51q9foR98/0Ztfu2L5ty51eGw601vulw//cmntWpVaM5z1NdX63++c4MuvbRVlZVlx23z+eet1t13f0Kvf91L5PPNrsX3+Tx6wxsu0913f0Lnn7da1pern7cVZ4kZgKXHZsxV+AhLe/rpp3XXXXdp69bspLmLLrpI//iP/8iylSgwI/cRlTQoGePKrnxTfF1QIpFSV9eAevvCOnp0RKWlfi1bVq66ukrV1lSc1DkymYw6u47qwIEuJZNprVpZpxUr6uYM0M+/nUm1t/eovb1X/hKvVq2s0/LlNae0i2omY6izs1/79nXKMLJLWzY11U6bU3AmZTKGuroGtG9/l2w2ae2a5Vq+vGbOFyfWZJPklGwlkqolleS+tlR+P1hZT0+Ptm7dqqefflrPPJN993DTpk26+OKLddFFF6m+3sqrS53dKLkBsEjyocah7IofLkkZFVMtfZ7b7VRzc/1pLZ1ot9u1oql23lHyM9NOl9avX3HKpTvT22nTihXZFxuLwW63qampVk0L+LgUVm5VJ8Mt2ZgMC2Bx0NMAWGS5yYLyiHW5sfQ4shNhbT5xfQNYLAR6AIssN1nQ5sttukMpApYK25SNpDziKRbAYqHkBsAisysbdlI6NoJpUzHW0gPHl79mp9bIF+9+CwCWLnobAIssN2nQrKN3ilF6WF/uujby1zTXNYDFQ6AHUCD5kXpKE2BVU0fm7bnaeU9uWVYAWDw8iwJYZFNXu8nvpEkAgtVN2UjKnBvCCD2AxUGgB1AguUBvMEKPpSC/ehMvUAEsPp5FARRIbr1um0fZemNWvIEV5d9tcio7EdYlnloBLDZ6HQAFMlcQygf6/K6yQLHLvTCVRzJ4YQqgMAj0AArIlptA6MmN1FOqAKuxKfuC1JPbGZYwD2DxEegBFNbUjXhsU9elJxjBCpzKToRlLgiAwmFjKQAFZs+FoaSOlStQbgMryJWN2fLLr/IOE4DCYDgBQIHla5DdufIbRudhBVOWXzXcypbdcN0CKAwCPYACy0+OdUm2fDCia0Kxsyt7rbqVfbPbLgI9gEKh5AZAkcit421LScpIRrrQDQKOI78xmk+U2gAoNIbBABSJ/E6bHsmga0Kxs+d2OaZ2HkDh8awJoEjkRuiN/E6blC+gWOXLxPKBnqdSAIVFLwSgSNiVrQJ0iZ1jUbzyK9u4dOxa5akUQGHRCwEoIvbsWvQ2j6ZPjmXnWBQJmyM3eTtfasPTKIDCoycCUGTyO8fmS2+AImLYZc714CkUQJGgNwJQZBySfGLnWBQlc2djXnACKB4EegBFJr/RlEcyqKVHsbBJsuc2P/Moe43yFAqgONAbASgyNklOyXDlJh5Sp4xiYJO5o7E5GZYXmgCKA8+SAIpMbiTU5pSM/E6cBCcUWu6dI5tH7AwLoNgQ6AEUKTbuQTFh3XkAxYteCUCRyq0mYvPmJiIyGopCya897xGTYQEUI2ehGwAAc8tPPkzmJiLmAz3r0WOh5a8x25SP/PU4dX8EACgO9EoAilQ+RLlyG/kwCRGFYMvO57DlJ8PybhGA4kOgB1Dk5tpoip1jsZCm7ntglww2kgJQ3OidABS5mTtzEuSxmNhICkDxI9ADKHJ2HQtUU5cKpOwBi8Eh2Xw6dv0BQPGhdwJQ5PI7x7pzdcxsNIXFMGUOh6bWzwNA8eFZEYAF2JXdPTa/0RRdFxaaXdlrzZ1bZYlrDkDxYtlKAEUuX1ozZRlLpXMfwELJ74PAxmYAih9DDgAsIlfLbKOWGYvA5shda0yGBVD8eFYEYBE2ZeuYPcq+uTh1gixwptiUXarSQYkXAMuglwJgEfk6+vzkRAI9FkIu0Mup7AtIl7jOABQ7Aj0Ai8itOmJz6tiqIwQtnGn5d4Lcks0lXjgCsAImxQKwGHu2ttlIicmxOPPy6877xJgXAKugtwJgMfmdO1l9BAshv5oS1xcA6yDQA7CYXOCy5VcfoRwCz5eR+8jLbyZFoAdgLQR6ABaUq6O3ubI19Ta6Mpyu3ERYW34iLBWpAKyDZ0EAFpXb+Ece0ZXh+bHp2Ds8+evJLUbmAVgNz4IALCYfwqilx5lkz+0KO7WUi3IuANZAoAdgUflA75UMujKcLodk5HeG5XoCYC30WgAsyi7WC8fpy7/bk7uWKLkBYEEEegAWNSWIGfkwRqDHqZq5KywrJwGwHgI9AAvL7x7LZEY8XzZll0H15HYhJswDsB4CPQCLy9XS27ySjUCPU5Vfd57aeQDWxUK7ACwuF8iMhKbX0RvP/5Q4C+SvE0dukzK3CPQArIreC4DF2SS5cmU3TtGt4eTl6+fzk2G5dgBYE70XAIvL1dEb+V0+CfU4GUyGBbB08KwHYGmw2bPriNuohcZ8DB0rxbIrO/fCJ64XAFZHLwZgiXBM2emTrg0nYHPkwrxHXC8ArI5JsQCWCIckn6S0WL4Sc5tSUmPYp7wA5HoBYG0MSwBYIqZOcKSWHvOZWTvPdQLA+ujFACwh9uzIqzyilAJzs0tysyoSgCWFngzAEpPbaIplCDGn3M6wlNoAWEJ4tgOwxOQ2mmL1Eswp/4KPd3AALB1MigWwtNhyJRVKSyrR2d7NRSIT6u09qkgkKkkKBPwKhZYpECgpdNMKxCPZ/OIdHABLydn9TAdgCbIp27X5sxtNGelCN6igenoP6IEHnta+tgOSpHUta7R586vUEqgrdNMKw+YQG0kBWGoI9ACWGFvuwy7JddZntkgkrba2Dm3duk2SZMihl740LdkChW4aAOAM4f1GAAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMKchW4ATl4mk1E6nVYikVA0GlUymZzzuHA4rEQiYd5OJBIKh8Pq6emZ83i3262SkhJ5PB7ZbDbZbLZC/6oAToD+AMBMyWRS0WhUiURC6XRamUxm2vcHBgY0MjKiaDSqVColSYpGoxoZGdHAwMCs8zkcDjmdTnk8Hnm9XjmdxMZixf+MhaTTaUWjUYXDYXV1dWlsbGzO4w4dOqRIJGLejkQi2r9//7xP+BUVFVq5cqWqq6vlcrl4AgcsgP4AwEzRaFSdnZ0Kh8OKxWJmaM8bGRnRoUOHNDQ0ZL7QHxoa0qFDh2Sz2VReXj7teI/Ho0AgoKqqKoVCIZWWlhb6V8Q8CPQWND4+rgMHDqi7u1uZTEaGYUz7fjgcnvUE3tbWpsHBwWnH2e12ORwONTU1admyZaquri70rwbgFNEfAMhLJpMaHh7WkSNH1N/fr/Hx8Wnfzw8CTH3nLhwOS8r2DX6/f9rxwWBQTU1Ncrlc9AlFjkBvIQ6HQ36/X5lMRocOHdKuXbuUSqVmvaUWj8fnfAL3eDzTjnM6nfL5fLLZbNq0aROjcYCF0B8AmCmTySiVSml4eFh79+5Vf3//tO+nUiklEgklEgnF43FJx1709/T0zCqpqa+vV2lpqRoaGmb1LSguBHoLsdvtstvtcjqdSqfTmpiY0NjYmPlHOZ98zexMPp9PlZWVSqVSstlsstuZIw1YBf0BgJkcDod8Pp8cDodGRkbmnSszVTQaVTQanfN7+Rf5Ho9HDoej0L8ejoMe24K8Xq/q6upUV1cnr9crSTIMY9Zb7XOZepzH41F1dbWqqqrkdrsL/WsBeB7oDwDkzdUf5J2oX5jr+x6PR1VVVaqurqZfKHIEegs63h/sqfB4PKqpqVFNTc1pnQdA4dAfAMhzu92qqKhQVVWVAoGAPB7P83q3zW63y+PxqLS0VBUVFSorK5PL5Sr0r4fjINBb0Jl6Aj9T5wFQOPQHAPLyc2uCwaDKy8sVCASeVxB3uVwKBAIqLy9XMBiU3++n5KbIEegtKP/EGwqFVFJSIrvdfkqT1/L1sSUlJQqFQjyBAxZGfwAgz263y+VyqbS0VHV1daqpqZk1Af5k5N+xq6urU2lpqVwuF/Nqihz/Oxbk9XoVCoXM2edOp9N8Ep+vRi7/9fyTt9PpVGlpqerr6xUKhXgCByyK/gDATH6/X42NjWpsbJy1FOVi3B+Lj0BvQfkn34qKClVWVioYDJ7SW2oul0vBYFCVlZWqqKgwQwAA66E/ADCT1+tVfX29Ghoa5PP5Tvn+Pp9PDQ0Nqq+v5wW+RRDoLWyumtf5tmqf+nVqZYGlh/4AQN7z+bumX7A2Ar2FPd8/OP5QgaWH/gBA3lyr3ZzMpNb86jaBQEBVVVWqqKhguUqLINBb2KmsPz316zyBA0sP/QGAvPlWu5lrbs3U26xuY10Eegs71dUtWM0CWLroDwDkPd/Vbljdxrr4X7Kwk1ndgtUsgLMD/QGAmU51tRpWt7EuAr2FnerqFqxmASxd9AcAZjrV1W5Y3ca6CPRLwPFWt2DWOnB2oT8AkHcyf+f0C0sDgX4JONk/QP5QgaWP/gBA3smudsPqNtZHoF8Cjre6BatZAGcX+gMAeSe72g2r21gfgX4JONETM6tZAGcP+gMAefnVbkpKSrRs2TJVV1fPudoNq9tYH/9bS0B+dYv5amZZzQI4e9AfAJjpeP2CxOo2SwGBfgnIPzmXl5ervLx81moVJ/o+gKWD/gDATCd6526uwA9rIdAvIV6vV7W1taqtrZ32B+nxeFRVVaWqqiomuQBnCfoDAHknCvT0C9ZHoF9C5vuDzdfGLVu27KR2igNgffQHAPLygb26ulper9fcdC5fhufxeFRRUcHqNhZGoF9C5nsCZzUL4OxDfwAgL7+RXHl5uXw+n5xOpxnonU6nfD6fucLN8TakQ/Ei0C8hPp9vzhq4/BN4KBQ6qZ3iAFgf/QGAvPwofGlpqYLBoAKBgJxOp5xOpwKBgILBoEpLS+XxeFjdxqKYCbWETH2invkEzmQX4OxCfwBgJo/Ho+rqai1btkzJZFKSjrucJayDQL+E5N9Sq6ysVEVFhcrLyyVJFRUVqqys5K004CxCfwBgpvzylEePHtXw8LAksVzlEkGgX0JsNpu521soFNLY2JgkKRQKTdsdDsDSR38AYKbS0lKtW7dOkUhE7e3tkqS1a9dq3bp1Ki0tLXTzcBoI9EtIfoKL3+9XXV2d4vG4JKmurk5+v5+6OOAsQn8AYCafz6f6+noNDAyoqqpKUnaEvr6+njk1FkegX4LytbP50beZ61ADOHvQHwDIy5fiLVu2TLW1tZKyNfSU4FlfcQb6TEZKJqV0WspkZBhGoVtkKd50WnVlZco/ZZeXlcmbTsuIRArdNGux2SSbXTanQ3K5JEY0C4P+4LTQH5wh9AfFhX7hebFJckuq9Hq1prFRyn3uTiSkREI8iqeoiPqF4gz0yaSM0VHZYpMykgkpwyV2KryJhOpsdlX4shNcPDa7vMMj0kS00E2zFrs9+wfq90tlAYkVAAqD/uC00B+cIfQHxYV+4bQEY5M6P1Rvfq7evkI3yZqKqF8ozkCfTmf/SCMRKZXKvgLHSXNlMgoahtLO7H+vwzDkisWkXA0tTlLuD9WQJL9fNp6/C4P+4LTQH5wh9AfFhX7htPhTKTXmJsH6k0mJd+yenyLqF4oz0Gcy2VfcqVT2bTWcEpvNJpfTaf7n2nJfwykyjOxbusmkZHAdFgz9wWmhPzhD6A+KC/3CaXE4HPLnRpMdDkehm2NdRdQvFGWgNwwj+/YZr7ifl/zqFjhNhpH9yGSy/6Ig6A9OD/3BGUJ/UFToF06P3WaT3VmUEdBaiqhfYFYPAAAAYGEEegAAAMDCCPQAAACAhRHoAQAAAAsj0AMAAAAWRqAHAAAALIxADwAAAFgYgR4AAACwMAI9AAAAYGEEegAAAMDCCPQAAACAhRHoAQAAAAsj0AMAAAAWRqAHAAAALIxADwAAAFgYgR4AAACwMAI9AAAAYGEEegAAAMDCCPQAAACAhRHoAQAAAAsj0AMAAAAWRqAHAAAALIxADwAAAFgYgR4AAACwMAI9AAAAYGEEegAAAMDCCPQAAACAhRHoAQAAAAsj0AMAAAAWRqAHAAAALIxADwAAAFgYgR4AAACwMAI9AAAAYGEEegAAAMDCCPQAAACAhRHoAQAAAAtzFroBS8nN3/++nm7bK0m6cO1a3XDtdYVu0pLQEw7rvf/x7+btG//2HTpv9epCNwuYF33BwqAvgJXRLywM+oUsAv0Z1D88pEN9fZKkUFVVoZuzZKRSKfNxlaRYPF7oJgHHRV+wMOgLYGX0CwuDfiGLkhsAAADAwgj0AAAAgIUR6AEAAAALI9ADAAAAFsak2DlEolE9/NSfta+zU22dnTo6MqK6ikqFqqv08gsv1BWbLpLdZjupc/UMDuqBJ5/QjvZ2tff2qr6qSs319frrK6/Syrq64963b2hI9z/+mLYfPKjB0VGNjo+rOhhUU22t1i5frrdfcaX8Hs+s+x0dGdFPH33UvP2myy9XdTCo+594XM/s26ed7e1yu1xaUVenv1h/jt54+eVz/j7f/MUvlEylJEmXbNigC9eu1RO7duqx557T9oMHNRGLaUVdndY3Nem6V75SJV7fcX+f8VhMv3jySbV1dqqt84gmYjGta2xUS2OTLmpp0QVr1hT6vx6Yhr4gi74AOIZ+IYt+obgQ6GfYfeiQPnLXneoZHJz29YHhYT3XflAP//nPWllXp5v/6Z1a09Bw3HPtPXJE7/3P/9DQ2Jj5tf6hIT27f78eeOIJXf83V+t1L37xnPf9xi8e0F3336+MYUz7+uDoqPYeOaJfPfWUfvz73+ujV1+jy847b9Yx3/jFA+btc5ub9Yn//rb+vGfPtOMOdHfrt1u36hdPPqlb3vlOLSsvn/b97zz0S0Vzs8XdLqf+sH27vvurh6cd03X0qB7fsUP/+/jj+tw//tO8f3B7Dh/WR+66U91Hj866/yPPPCNJeserXq13v/GNJ90RAguJvuAY+gIgi37hGPqF4kLJzRS/fvpp/d0Xbpn2h+qw2xXw+6cdd6ivT++//SsajkTmPdehvj794xdv1dDYmFxOp4IlpdO+H08mdfP3v6eB4eFZ973jvp/pv37+82l/qA67XfXV1XI7j70GGxge1vV3/tesjmWmj379LvMP1e1yzfr+c+0H9ZV7f3rcc/z3Qw+Zf6hOh0MO+/RLZ2BkRDd9+1vmq/Wp/vDcdv3dLTdP+0N1u1yqLCub8TN+qX/59y8rMcc5gMVEXzA/+gKcregX5ke/UHiM0OdMTMZ06w9/YF5spT6fbvzbd+gl554rp9OpXR0d+t2zz+q7v3pYhmGoNxzWl398jz71f/9uzvP1hsNyOhz62DXXavOLXiS306necFif+e7/6E+7d0uSEqmU/ufhh/Wvf/VX5v2GIxF991e/Mm+3NDXpg297uzasXCmv261MJqOfP/64Pv/97ymTySiRTOr2n92rz/3DP877u0UnJ9XS1KQbrrlW56xYoVgioceee0633v1Ds8P55Z/+pHe8+tVqDtXPe46KQEAf+Zurdfn558tms2n34UO6+fvf177OTklS99Gj+vnjj+ktL32Zeb9YPK6bv/998w+wqaZGN1x7nS5ct052m03RyUnd8/vf6c7771cyldKf9+zRfVu26G0vf3mhLwmcpegL6AuAmegX6BeKHSP0Of/9y4c0NOXV9B3v/4Cu2LRJbpdLdptN5zY3671vfrOufcUrzGMe3bZ9zlebee96/Rv0pssvN18xh6qq9OV//hdVBALmMbsPHZp2nz9s326+snU5nfqP97xXm9atk9ftliTZ7Xa98bLL9MbLLjPv89zBg8f93SoDAX3l/71PG1aulM1mk9/j0Ste8AJ97JprzWMMw9CujkPznsNms+nz//iPuvKii+RyOuV0OHRe82r9+3vea7ZNkna2d0y737d/+aA5wuBxufTv73mvLmppMd8y83u92bfR3vCGY/8XD/3yuI8rsJDoC+gLgJnoF+gXih2BPueBJ58wP7/8/PO1YeXKOY9768tervNWr9Z5q1drdUO9Onp75zzO63brrXO8gnS7XLpi0ybzdk94+lthr3/JS/TY7V/V41+9Q7+4+RZVB4Nznv+85mPbGg8MDyuRTM77u73p8peqckoHkffyCy+cNmFmZu3aVBesWaOLW9bP+npNeblesP7Y17sHp5/jZ1u2mJ9fedHFaqqtnfP8b7/iSvOtvoHhYf1m61YBhUBfQF8AzES/QL9Q7Ci5kRSNx3V0ZMS8fWnrxnmPDVVV6VvXf+SE52xYtmzO2eWSVF9VbX4eHhuTYRiyzZjk4XG55HG5NDYxoa6jR9V19KgGRrJ/lIlkSu29PeaxGcPQyPi4aioq5vx5F6ydf2Z4qLpaB7u7JUkDI8PzHnfBmrXHeUyO/T79U+r9RifGZ9UQ/vyxx+Y9T3UwaNb6dUz5/YDFQl9AXwDMRL9Av2AFBHpJnf39026HqipP+5zzvWqWsrV3eYZhyJA0c872M/v36Xu/+pW2PPecjBmz2E/V8ZaK8kyZAJPOZOY/h8877/e87mPnyEw5R0dv37TjHvzjk3rwj0+eVJt7BsOn9TsDzwd9QRZ9AXAM/UIW/UJxI9Aru/bpVH6P93me6ZjTWVbpvx/6pW6/9945v+ew2+V2uWSTzOWiilUkGn3e9535NiOwGOgLFgZ9AayMfmFh0C+cWQR6ScuXLZt2+3hvKy20Xz311LQ/1OyGDK9S68qVqqmokCs3eeZ3zz6rD33tjoK182SsmFEL9943v0Uv3LDhpO7rcnJpYvHRFywM+gJYGf3CwqBfOLN4RCTVVFTI43Ipnps0cmjG20BTReNxve8//1PZN8Gkf37jm87o7mX/+8Tj5ucr6ur09Q99WL456uysUD/WsGyZnA6HUum0pOyyX+saGwvdLGBe9AULg74AVka/sDDoF84sVrlRdrmllqYm8/Z9j22Zd+OCp/bs0TP79+nZ/fu1s6NDa5c3nOyPOSHDMLSz49iSTpefd/6cf6jpTEa/e/bZQj9sJ+Sw26etWfubrVvnrcHb39Wly9/zL3rhu96pF77rnfrJo78vdPNxFqIvWBj0BbAy+oWFQb9wZhHoc975+tebnw+Ojuq2H909bfKGlJ2R/eUf32PefsH69cedTPJ8ZDLHJreEx0ZnfT+VTusLP/yB9hw+XOiH7KS8a8rasYf7+vS1++6bNYEnOjmpj339LkXjcaXSaTkdDr3qLy4pdNNxlqIvWBj0BbAy+oWFQb9w5lByk/MX68/RS849T4/teE6S9NNHH9Wew4f1wg0btKy8Qp0D/XrgiSc0lpvE4XG59C9vfNMZbYPNZlPrqpXmFswP/vGPSqZSevmFmxQsKdHBnh795NHf68iMGffF7LLzztPLL7zQHC3474d+qa372vTCDa0q8Xn15917tHVfm/lWpiS9/61vmzbLH1hM9AULg74AVka/sDDoF84cAv0UN73jHbrxW9/Uk7t2Scru0DZzl7a8G669bkFqvT74trfrbz//OU0mEpKkXz/9tH799NPTjinx+vSvf/VX+uR/f7vQD9lJ+ejV1ygSjenptr2SpB3t7drR3j7rOJvNpute+Uq9+aUvLXSTcZajL1gY9AWwMvqFhUG/cGZQcjNFRSCg/3zv/9N73/xmBUtK5zzmL845R/9zww16zQtfuCBtWN3QoK++7/1aP6VeL8/n8eiilhb9z8c+ppdecEGhH66TVllWpq994AP68F//zbyP6wVr1ug7H/uY3vOmNxe6uQB9wQKhL4CV0S8sDPqFM8NmnO6OBAvAiESk3j5pxg5ii21gZET7Ozs1PB5RQ/UyNdbUHHcziDP6GBiG2nt6dGRgQPFkQusaG7WyLnRaa9cWi4GRER3o7tLQ2Jgal9VoZahu3j/iohAISKE62ebYGhsLrxj6A/qChWG5vkCiPygS9Av0C0WlCPoFAj1wIkXwh3o2oz9AUaE/KAr0CygqRdAvUHIDAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYQR6AAAAwMII9AAAAICFEegBAAAACyPQAwAAABZGoAcAAAAsjEAPAAAAWBiBHgAAALAwAj0AAABgYc5CN2BONptkt2c/DCP7ASy23HVoc+SuRRQG/QGKAf1BcaFfQDEoon6hOHslm11yubIfNluhW4Ozld0uOZ0ynFyHBUV/gGJAf1Bc6BdQDIqoXyjKEXqb0yH5/TIkKZmUMplCNwlnIZvDLsPpks3vkxyOQjfnrEV/gGJAf1Bc6BdQDIqpX7AZRhG+T5XJSMmkjFRaMjK8lYaCsNnt2VfcDofkdBb8j/WsRX+AIkB/UGToF1AEiqlfKM5ADwAAAOCkFGcNPQAAAICTQqAHAAAALIxADwAAAFgYgR4AAACwMAI9AAAAYGEEegAAAMDCCPQAAACAhRHoAQAAAAsj0AMAAAAWRqAHAAAALIxADwAAAFgYgR4AAACwMAI9AAAAYGEEegAAAMDCCPQAAACAhRHoAQAAAAsj0AMAAAAWRqAHAAAALOz/B9Hdvcn5rNGoAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE4LTA1LTA3VDE2OjMxOjQ1KzA4OjAwWEU2JgAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOC0wNS0wN1QxNjozMTo0NSswODowMCkYjpoAAAAASUVORK5CYIIA)  

为了实现Selector管理多个SocketChannel，必须将具体的SocketChannel对象注册到Selector，并声明需要监听的事件（这样Selector才知道需要记录什么数据），一共有4种事件：

1、**connect**：客户端连接服务端事件，对应值为SelectionKey.OP_CONNECT(8)  
2、**accept**：服务端接收客户端连接事件，对应值为SelectionKey.OP_ACCEPT(16)  
3、**read**：读事件，对应值为SelectionKey.OP_READ(1)  
4、**write**：写事件，对应值为SelectionKey.OP_WRITE(4)

这个很好理解，每次请求到达服务器，都是从connect开始，connect成功后，服务端开始准备accept，准备就绪，开始读数据，并处理，最后写回数据返回。

所以，当SocketChannel有对应的事件发生时，Selector都可以观察到，并进行相应的处理。

### 服务端代码

为了更好的理解，先看一段服务端的示例代码

    ServerSocketChannel serverChannel = ServerSocketChannel.open();
    serverChannel.configureBlocking(false);
    serverChannel.socket().bind(new InetSocketAddress(port));
    Selector selector = Selector.open();
    serverChannel.register(selector, SelectionKey.OP_ACCEPT);
    while(true){
        int n = selector.select();
        if (n == 0) continue;
        Iterator ite = this.selector.selectedKeys().iterator();
        while(ite.hasNext()){
            SelectionKey key = (SelectionKey)ite.next();
            if (key.isAcceptable()){
                SocketChannel clntChan = ((ServerSocketChannel) key.channel()).accept();
                clntChan.configureBlocking(false);
                //将选择器注册到连接到的客户端信道，
                //并指定该信道key值的属性为OP_READ，
                //同时为该信道指定关联的附件
                clntChan.register(key.selector(), SelectionKey.OP_READ, ByteBuffer.allocate(bufSize));
            }
            if (key.isReadable()){
                handleRead(key);
            }
            if (key.isWritable() && key.isValid()){
                handleWrite(key);
            }
            if (key.isConnectable()){
                System.out.println("isConnectable = true");
            }
          ite.remove();
        }
    }
    

#### 服务端操作过程

1、创建ServerSocketChannel实例，并绑定指定端口；  
2、创建Selector实例；  
3、将serverSocketChannel注册到selector，并指定事件OP_ACCEPT，最底层的socket通过channel和selector建立关联；  
4、如果没有准备好的socket，select方法会被阻塞一段时间并返回0；  
5、如果底层有socket已经准备好，selector的select方法会返回socket的个数，而且selectedKeys方法会返回socket对应的事件（connect、accept、read or write）；  
6、根据事件类型，进行不同的处理逻辑；

在步骤3中，selector只注册了serverSocketChannel的OP_ACCEPT事件  
1、如果有客户端A连接服务，执行select方法时，可以通过serverSocketChannel获取客户端A的socketChannel，并在selector上注册socketChannel的OP_READ事件。  
2、如果客户端A发送数据，会触发read事件，这样下次轮询调用select方法时，就能通过socketChannel读取数据，同时在selector上注册该socketChannel的OP_WRITE事件，实现服务器往客户端写数据。

### Selector实现原理

SocketChannel、ServerSocketChannel和Selector的实例初始化都通过SelectorProvider类实现，其中Selector是整个NIO Socket的核心实现。

    public static SelectorProvider provider() {
        synchronized (lock) {
            if (provider != null)
                return provider;
            return AccessController.doPrivileged(
                new PrivilegedAction<SelectorProvider>() {
                    public SelectorProvider run() {
                            if (loadProviderFromProperty())
                                return provider;
                            if (loadProviderAsService())
                                return provider;
                            provider = sun.nio.ch.DefaultSelectorProvider.create();
                            return provider;
                        }
                    });
        }
    }
    

SelectorProvider在windows和linux下有不同的实现，provider方法会返回对应的实现。

这里不禁要问，Selector是如何做到同时管理多个socket？

下面我们看看Selector的具体实现，Selector初始化时，会实例化PollWrapper、SelectionKeyImpl数组和Pipe。

    WindowsSelectorImpl(SelectorProvider sp) throws IOException {
        super(sp);
        pollWrapper = new PollArrayWrapper(INIT_CAP);
        wakeupPipe = Pipe.open();
        wakeupSourceFd = ((SelChImpl)wakeupPipe.source()).getFDVal();
    
        // Disable the Nagle algorithm so that the wakeup is more immediate
        SinkChannelImpl sink = (SinkChannelImpl)wakeupPipe.sink();
        (sink.sc).socket().setTcpNoDelay(true);
        wakeupSinkFd = ((SelChImpl)sink).getFDVal();
        pollWrapper.addWakeupSocket(wakeupSourceFd, 0);
    }
    

**pollWrapper**用Unsafe类申请一块物理内存pollfd，存放socket句柄fdVal和events，其中pollfd共8位，0-3位保存socket句柄，4-7位保存events。

![](data:image;base64,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)  

 

![](data:image;base64,iVBORw0KGgoAAAANSUhEUgAAAegAAACsCAYAAACw7j/CAAAgAElEQVR4Ae2dCdhVRRnHXxRBSwOU1cTASFBKIsUVkbIUCcQEt4SKR9TSTHsUrXBPLTV3Ms0KI8uFR0PJJdwXXFEkJEiRLEVAUBRXFin+o3M99/Lde893Oeeec+75vc/zffcsM3NmfrO8M+/MmdPif2vFEAhAAAIQgAAEUkVgg1TFhshAAAIQgAAEIOAIoKApCBCAAAQgAIEUEkBBpzBTiBIEIAABCEAABU0ZgAAEIAABCKSQAAo6hZlClCAAAQhAAAIoaMoABCAAAQhAIIUEUNApzBSiBAEIQAACEEBBVygD99xzj+244462aNEiCx5X8MItCEAAAhCAQCQEUNA1YDz22GNt6NCh6/g866yzbKeddrI33nij6N55551nAwYMMPaEKcLCCQQgAAEIVCCAgq4Ap9ytXXfd1V599VVbvHhxkZOnnnrKKeFHHnmk6PrMmTPty1/+srVo0aLoOicQgAAEIACBcgRQ0OXIVLg+cOBAdzeoiBcsWGALFy60rbbayh5//PGC73feecdefPFF23nnnQvX/EGaR9Rpjpvnxy8EIACBRibQkArazxfPmDHDjj76aNOIVybmc845x1avXl3IzzVr1thll11m++67r/Xr18/9XnXVVYX75Q66du1qXbp0sSeffLLg5IEHHrD27dvbHnvsYf/4xz8K15944gk3qtbzfbzuuusuGzRokB144IHO3dNPP21HHHGE87vLLrvYoYcearNnz3b3vJ9KaQnjRoEp7d7cvvvuu9txxx1nb775ZtFzSuPmbvIPAhCAAATqTqAhFbSnePbZZ9vee+9tEyZMsCOPPNKmTJliF110kb/tFPakSZNszJgxNnHiRDvssMPs2muvtWuuuabgptyBFPqzzz5buK1Rs+afpaA1kpYJXCIl3rlzZ9t6660Lbq+77jo7/fTT7cwzz3TX5LdPnz42fvx497dy5UobN25cwb0OqqUljBt1UKZNm2bnnnuuXXLJJfbSSy8V4uAfVho3f51fCEAAAhCoL4GW9X1cfZ92+OGH24gRI9xDt9tuO6c0b7/9djv55JPtrbfeMh1rwddBBx1UcPPyyy/bjTfe6BR6pdhKEd92221OyUn5atR80kknOVP2xhtvbA8//LAdcsghpvnnvn37FgWl52kE60VxCIrirZHu8uXLC5crpcU7quRG6b3zzjvtggsusD333NN5GTlypFPUQatCadx82PxCAAIQgEB9CTS0gt5tt92KaO6www5200032bJly2zu3LnO5Nu/f/8iN1KmkydPdgq86EbJiRR0y5YtTfPQUv6aa5bi22ijjax3795u5DxkyBA3/zxq1Kgi36UK+7XXXrM//elPzqythWdLly517t97772Cv0pp8Y4qufHpPeWUU7xz+/DDD01mfvHwUho3f51fCEAAAhCoL4GGVtAbbFBswX///ffdSupNNtnEKSahLnXj8W+44Yb+sMlfhSHFPH36dHv99detR48e1rZtW+dW5m+NwjX/LAVY2glo1apVIUzFSQpcc9qae95mm23s+eeftzPOOKPgRgel8QymxTus5EbKWHL++ec7k7v3o9/NN9+8cBqMW+EiBxCAAAQgUHcCxRqs7o+P94EaNQZF869a4CXl2qtXL3fr0UcfDTpxJmkpy0033bToelMnWnw2a9Ysp6SllL1oJK1R6a233uoUd5s2bfytdX61QEwj5lNPPdUtHNt2221NK8JLpVJavNtKbtSB0GteilfPnj2L/qp1Rnz4/EIAAhCAQP0INPQIWgvCVqxY4RZoTZ061R566CGnCIVXK64HDx5sWrXdunXrglla88qaow4jWpmtBWUybx9zzDEFL1L+Gk1r8ZefAy/cLDno2LGju6LFWQcffLA999xzdsstt5S4Mre4rVxavONK6VWnQ7uiXXHFFaZRcvfu3U2dA43EtYAOgQAEIACBdBFoaAWtxVdXX321vfLKK9apUycbO3asDRs2rJADMiNffPHFduWVV7oFWVptrYVew4cPL7ipdLD99ttbu3btTHPFwRG0/Ggu9/777y9aDNZUWBoxH3XUUXb99de7RVza0ESvXMkUHZRqaZHbam60QEwrx7WKWwvDpKR//OMfBx/DMQQgAAEIpIRAi7UbUvwvJXGJLBp6L1iLobRKW0o3yxImLWHcZJkBcYcABCCQRwINPQedxwwlzRCAAAQg0BgEUNCNkY+kAgIQgAAEGowACrrBMpTkQAACEIBAYxBoyDnoxsgaUgEBCEAAAnkmwAg6z7lP2iEAAQhAILUEUNCpzRoiBgEIQAACeSaAgs5z7pN2CEAAAhBILQEUdGqzhohBAAIQgECeCaCg85z7pB0CEIAA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S87o0aNDJWvChAmh3OEIAkkRCFuWk4ofdSgp8jw3LIF61CFfD8aOHRs2WlXd5X4E3aFDh6qQcACBpAjo60BpF+pQ2nMo3/HLQh0ql0O534t7yJAh5dhwHQIQCEGAOhQCEk4gUAOB3I+ga2CGFwhAAAIQgEDsBHI/gq6F8H/+8x+777773Dec99tvv1qCwA8EIACBmgnQBtWMLlMeGUE3M7tee+01u//++50vfZD9hRdeaGYIOIcABCBQOwHaoNrZZc0nCroZObZ8+XK79957Lbjw/dFHH7VXX321GaHgFAIQgEBtBGiDauOWVV8o6JA598EHH9jdd99t+u3evbudeOKJ1q9fP1uzZo0zdy9btixkSDiDAAQg0HwCtEHNZ5Z1HyjoEDn44YcfupGzeq9asr///vvbBhtsYHvttZf17NnTVq1aZVOnTrV33303RGg4gQAEINA8ArRBzePVKK5R0FVyUubsBx980DTvs9lmm9nw4cOtVatWzleLFi1s8ODB9tnPftbee+89N8KWskYgAAEIREWANigqktkLBwVdJc+efPJJ04rJ1q1b24gRI2zTTTct8tGyZUv71re+Ze3atTOZubWATGZvBAIQgEAUBGiDoqCYzTBQ0BXy7Z///KfpT+bsAw44wNq3b9+k60022cQp70996lO2YMEC08IxBAIQgMD6EqANWl+C2fZf017cb7/9tj333HP23//+19544w23cGr16tXZJlEh9t/85jdt++23r+Dio1sLFy60G264wRqZRVUIGXKgKQpZRtq0aWNdunSxHj16uGmMDCWBqMZEQOtJ5s2bZ6rTb731lq1YscI0D5yU0AZFQz7OOh/HXtzNUtAqoA899JBNnz49GlopD0WZOWDAANt5551Dx1SVesqUKSjp0MTS41D53atXL7c6f8MNN0xPxIhJ3QiojXv66adtzpw5qZiqog2KN+ujrPOJKmgV3JtvvrkwH7vDDjvYNttsY1tssYVtvPHGRoMWb0Ei9OgJaK2AXl2RFWj+/Pk2c+ZMd965c2fbZ599KNPRI091iGrj7rnnHrevgSwrtHGpzq6aIhdnnY9DQYfe6lMjZy2WUuN14IEH2qc//emaAOEJAmkhoLUFWjegv6222sp22mknu+WWW5xZU1aiXXbZJS1RJR51IKCRszYdoo2rA+yEHpG1Oh9qkZjmnJ955hk3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)  

pollWrapper提供了fdVal和event数据的相应操作，如添加操作通过Unsafe的putInt和putShort实现。

    void putDescriptor(int i, int fd) {
        pollArray.putInt(SIZE_POLLFD * i + FD_OFFSET, fd);
    }
    void putEventOps(int i, int event) {
        pollArray.putShort(SIZE_POLLFD * i + EVENT_OFFSET, (short)event);
    }
    

先看看`serverChannel.register(selector, SelectionKey.OP_ACCEPT)`是如何实现的

    public final SelectionKey register(Selector sel, int ops, Object att)
        throws ClosedChannelException {
        synchronized (regLock) {
            SelectionKey k = findKey(sel);
            if (k != null) {
                k.interestOps(ops);
                k.attach(att);
            }
            if (k == null) {
                // New registration
                synchronized (keyLock) {
                    if (!isOpen())
                        throw new ClosedChannelException();
                    k = ((AbstractSelector)sel).register(this, ops, att);
                    addKey(k);
                }
            }
            return k;
        }
    }

1、如果该channel和selector已经注册过，则直接添加事件和附件。  
2、否则通过selector实现注册过程。  

	protected final SelectionKey register(AbstractSelectableChannel ch,  int ops,  Object attachment) {
		if (!(ch instanceof SelChImpl))
			throw new IllegalSelectorException();
		SelectionKeyImpl k = new SelectionKeyImpl((SelChImpl)ch, this);
		k.attach(attachment);
		synchronized (publicKeys) {
			implRegister(k);
		}
		k.interestOps(ops);
		return k;
	}

	protected void implRegister(SelectionKeyImpl ski) {
		synchronized (closeLock) {
			if (pollWrapper == null)
				throw new ClosedSelectorException();
			growIfNeeded();
			channelArray[totalChannels] = ski;
			ski.setIndex(totalChannels);
			fdMap.put(ski);
			keys.add(ski);
			pollWrapper.addEntry(totalChannels, ski);
			totalChannels++;
		}
	}

1、以当前channel和selector为参数，初始化SelectionKeyImpl 对象selectionKeyImpl ，并添加附件attachment。  
2、如果当前channel的数量totalChannels等于SelectionKeyImpl数组大小，对SelectionKeyImpl数组和pollWrapper进行扩容操作。  
3、如果totalChannels % MAX\_SELECTABLE\_FDS == 0，则多开一个线程处理selector。  
4、pollWrapper.addEntry将把selectionKeyImpl中的socket句柄添加到对应的pollfd。  
5、k.interestOps(ops)方法最终也会把event添加到对应的pollfd。

所以，不管serverSocketChannel，还是socketChannel，在selector注册的事件，最终都保存在pollArray中。

接着，再来看看selector中的select是如何实现一次获取多个有事件发生的channel的，底层由selector实现类的doSelect方法实现，如下：

     protected int doSelect(long timeout) throws IOException {
            if (channelArray == null)
                throw new ClosedSelectorException();
            this.timeout = timeout; // set selector timeout
            processDeregisterQueue();
            if (interruptTriggered) {
                resetWakeupSocket();
                return 0;
            }
            // Calculate number of helper threads needed for poll. If necessary
            // threads are created here and start waiting on startLock
            adjustThreadsCount();
            finishLock.reset(); // reset finishLock
            // Wakeup helper threads, waiting on startLock, so they start polling.
            // Redundant threads will exit here after wakeup.
            startLock.startThreads();
            // do polling in the main thread. Main thread is responsible for
            // first MAX_SELECTABLE_FDS entries in pollArray.
            try {
                begin();
                try {
                    subSelector.poll();
                } catch (IOException e) {
                    finishLock.setException(e); // Save this exception
                }
                // Main thread is out of poll(). Wakeup others and wait for them
                if (threads.size() > 0)
                    finishLock.waitForHelperThreads();
              } finally {
                  end();
              }
            // Done with poll(). Set wakeupSocket to nonsignaled  for the next run.
            finishLock.checkForException();
            processDeregisterQueue();
            int updated = updateSelectedKeys();
            // Done with poll(). Set wakeupSocket to nonsignaled  for the next run.
            resetWakeupSocket();
            return updated;
        }
    

其中 subSelector.poll() 是select的核心，由native函数poll0实现，readFds、writeFds 和exceptFds数组用来保存底层select的结果，数组的第一个位置都是存放发生事件的socket的总数，其余位置存放发生事件的socket句柄fd。

    private final int[] readFds = new int [MAX_SELECTABLE_FDS + 1];
    private final int[] writeFds = new int [MAX_SELECTABLE_FDS + 1];
    private final int[] exceptFds = new int [MAX_SELECTABLE_FDS + 1];
    private int poll() throws IOException{ // poll for the main thread
         return poll0(pollWrapper.pollArrayAddress,
              Math.min(totalChannels, MAX_SELECTABLE_FDS),
                 readFds, writeFds, exceptFds, timeout);
    }
    

执行 selector.select() ，poll0函数把指向socket句柄和事件的内存地址传给底层函数。  
1、如果之前没有发生事件，程序就阻塞在select处，当然不会一直阻塞，因为epoll在timeout时间内如果没有事件，也会返回；  
2、一旦有对应的事件发生，poll0方法就会返回；  
3、processDeregisterQueue方法会清理那些已经cancelled的SelectionKey；  
4、updateSelectedKeys方法统计有事件发生的SelectionKey数量，并把符合条件发生事件的SelectionKey添加到selectedKeys哈希表中，提供给后续使用。

在早期的JDK1.4和1.5 update10版本之前，Selector基于select/poll模型实现，是基于IO复用技术的非阻塞IO，不是异步IO。在JDK1.5 update10和linux core2.6以上版本，sun优化了Selctor的实现，底层使用epoll替换了select/poll。

#### read实现

通过遍历selector中的SelectionKeyImpl数组，获取发生事件的socketChannel对象，其中保存了对应的socket，实现如下

    public int read(ByteBuffer buf) throws IOException {
        if (buf == null)
            throw new NullPointerException();
        synchronized (readLock) {
            if (!ensureReadOpen())
                return -1;
            int n = 0;
            try {
                begin();
                synchronized (stateLock) {
                    if (!isOpen()) {         
                        return 0;
                    }
                    readerThread = NativeThread.current();
                }
                for (;;) {
                    n = IOUtil.read(fd, buf, -1, nd);
                    if ((n == IOStatus.INTERRUPTED) && isOpen()) {
                        // The system call was interrupted but the channel
                        // is still open, so retry
                        continue;
                    }
                    return IOStatus.normalize(n);
                }
            } finally {
                readerCleanup();        // Clear reader thread
                // The end method, which 
                end(n > 0 || (n == IOStatus.UNAVAILABLE));
    
                // Extra case for socket channels: Asynchronous shutdown
                //
                synchronized (stateLock) {
                    if ((n <= 0) && (!isInputOpen))
                        return IOStatus.EOF;
                }
                assert IOStatus.check(n);
            }
        }
    }
    

最终通过Buffer的方式读取socket的数据。

#### wakeup实现

    public Selector wakeup() {
        synchronized (interruptLock) {
            if (!interruptTriggered) {
                setWakeupSocket();
                interruptTriggered = true;
            }
        }
        return this;
    }
    
    // Sets Windows wakeup socket to a signaled state.
    private void setWakeupSocket() {
       setWakeupSocket0(wakeupSinkFd);
    }
    private native void setWakeupSocket0(int wakeupSinkFd);
    

看来wakeupSinkFd这个变量是为wakeup方法使用的。  
其中interruptTriggered为中断已触发标志，当pollWrapper.interrupt()之后，该标志即为true了；因为这个标志，连续两次wakeup，只会有一次效果。

### epoll原理

epoll是Linux下的一种IO多路复用技术，可以非常高效的处理数以百万计的socket句柄。

三个epoll相关的系统调用：

*   **int epoll_create(int size)**  
    epoll_create建立一个epoll对象。参数size是内核保证能够正确处理的最大句柄数，多于这个最大数时内核可不保证效果。
*   **int epoll\_ctl(int epfd, int op, int fd, struct epoll\_event event)**  
    epoll\_ctl可以操作epoll\_create创建的epoll，如将socket句柄加入到epoll中让其监控，或把epoll正在监控的某个socket句柄移出epoll。
*   **int epoll\_wait(int epfd, struct epoll\_event events,int maxevents, int timeout)**  
    epoll_wait在调用时，在给定的timeout时间内，所监控的句柄中有事件发生时，就返回用户态的进程。

epoll内部实现大概如下：

1.  epoll初始化时，会向内核注册一个文件系统，用于存储被监控的句柄文件，调用epoll_create时，会在这个文件系统中创建一个file节点。同时epoll会开辟自己的内核高速缓存区，以红黑树的结构保存句柄，以支持快速的查找、插入、删除。还会再建立一个list链表，用于存储准备就绪的事件。
2.  当执行epoll_ctl时，除了把socket句柄放到epoll文件系统里file对象对应的红黑树上之外，还会给内核中断处理程序注册一个回调函数，告诉内核，如果这个句柄的中断到了，就把它放到准备就绪list链表里。所以，当一个socket上有数据到了，内核在把网卡上的数据copy到内核中后，就把socket插入到就绪链表里。
3.  当epoll_wait调用时，仅仅观察就绪链表里有没有数据，如果有数据就返回，否则就sleep，超时时立刻返回。

  
  
作者：占小狼  
链接：https://www.jianshu.com/p/0d497fe5484a  
來源：简书  
著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。





Questions
=======

1. pollWrapper用Unsafe类申请一块物理内存pollfd，存放socket句柄fdVal和events，其中pollfd共8位，0-3位保存socket句柄，4-7位保存events。  
是位？还是字节？








